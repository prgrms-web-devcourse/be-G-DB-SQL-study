## 집합 연산

- UNION 합집합

  - A UNION B

    ```sql
    SELECT * FROM SAMPLE1
    UNION
    SELECT * FROM SAMPLE2
    ```

  - 각각의 SELECT 명령의 열의 내용은 서로 일치해야 한다.
  - 마지막 SELECT 명령에만 ORDER BY를 지정한다. -> 합집합의 결과를 정렬한다.
  - 결과에는 중복값이 제거되어 있다.

- UNION ALL
  - 중복을 제거하지 않고 합친다.

- 교집합과 차집합

  - MySQL에서는 지원되지 않는다.

  - A-B

    ```sql
    SELECT 열1, 열2, ...
    FROM 테이블1 A
    LEFT JOIN 테이블2 B
    ON A.key = B.key
    WHERE B.key IS NULL;
    ```

  - B-A

    ```SQL
    SELECT 열1, 열2, ...
    FROM 테이블1 A
    RIGHT JOIN 테이블2 B
    ON A.key = B.key
    WHERE A.key IS NULL;
    ```

  - 교집합

    ```sql
    SELECT 열1, 열2, ...
    FROM 테이블1 A
    INNER JOIN 테이블2 B
    ON A.key = B.key;
    ```

    

## 테이블 결합

가로(열) 방향으로 데이터가 늘어나는 계산

- 곱집합 : 두 개의 집합을 곱하는 연산 방법. 평상시에는 잘 사용하지 않는다.
- 교차결합(Cross Join) : FROM 구에 테이블을 두 개 지정하면 곱집합으로 계산된다.

- 내부결합

  - 교차결합으로 계산된 곱집합에서 원하는 조합을 검색하는 것을 말한다.

    ```sql
    SELECT *
    FROM 테이블1 A
    INNER JOIN 테이블2 B
    ON A.key = B.key;
    ```

- 외부결합

  - **'어느 한 쪽에만 존재하는 데이터행을 어떻게 다룰지'**를 변경할 수 있는 결합 방법이다.

  - 결합하는 테이블 중에 어느 쪽을 기준으로 할지 결정할 수 있다. - LEFT JOIN, RIGHT JOIN

    ```sql
    SELECT A.name, B.amount
    FROM 테이블1 A LEFT JOIN 테이블2 B
    ON A.id = B.id
    WHERE A.category = '식료품';
    ```



## 관계형 모델

관계형 데이터베이서의 기반이 되는 이론적 개념

- 릴레이션(Relation) : SQL의 테이블
- 속성(attribute) : SQL의 열
- 튜플(tuple) : SQL의 행

관계형 모델은 데이터 구조에 관해 정의한다.

릴레이션은 튜플의 집합이며, 릴레이션에 대한 연산이 집합에 대한 연산에 대응된다는 이론을 '관계대수'라고 한다.

관계대수의 기본 규칙

- 하나 이상의 관계를 바탕으로 연산한다.
- 연산한 결과, 반환되는 것 또한 관계이다.
- 연산을 중첩 구조로 실행해도 상관없다.

릴레이션의 연산 방법의 몇 가지 규정

- 합집합 - 릴레이션끼리의 덧셈
- 차집합 - 릴레이션끼리의 뺄셈
- 교집합 - 릴레이션끼리의 공통부분
- 곱집합 - 릴레이션끼리의 대전표를 조합하는 연산
- 선택 - 튜플의 추출
- 투영 - 속성의 추출
- 결합 - 릴레이션끼리 교차결합해 계산된 곱집합에서 결합조건을 만족하는 튜플을 추출하는 연산



## 데이터베이스 설계

데이터베이스의 스키마 내의 데이터베이스 객체를 정의하는 것을 말한다. - 스키마 설계

- 논리명 : 테이블의 설계상 이름
- 물리명 : 데이터베이스에 사용될 이름

데이터베이스 시스템에서 데이터 정합성을 체크할 수 있다면 데이터베이스에 맡겨버리는 편이 가장 확실하고 편리하다. 

> 데이터 정합성 : 서로 모순이 없이 일관되게 일치해야 한다는 의미. 데이터 값이 각각 일치해야 한다는 뜻.

큰 데이터는 LOB 형으로 저장한다. 인덱스를 지정할 수 없다는 제약이 있다.

자동증가 열 : INSERT 할 경우 번호를 자동으로 증가시켜 저장해주는 편리한 열. 

- MySQL의 경우  AUTO_INCREMENT를 지정한다.
- AUTO_INCREMENT로 지정한 열은 PRIMARY KEY 또는 UNIQUE로 유일성을 지정해야 한다.

ER다이어그램 : 테이블 간의 관계를 명확히 하기 위해 설계도를 작성하는데, 이런 경우에 쓰이는 도식이다. 

- ER다이어그램의 관계는 관계형 데이터베이스의 릴레이션과 달리 릴레이션십(연계)를 가리킨다.
- 연계를 표기할 때는 서로 몇개의 데이터 행과 연관되는지, 몇 대 몇의 관계를 가지는지를 숫자나 기호로 나타낼 수 있다. - 일대일, 일대다, 다대다

### 

## 정규화

테이블을 올바른 형태로 변경하고 분할하는 것을 의미한다.

- 제1정규형
  - 하나의 셀에 하나의 값만 저장할 수 있도록 하고, 반복되는 부분을 세로(행) 방향으로 늘려나간다.
  - 반복되는 부분을 찾아내서 테이블을 분할하고 기본키가 될 열을 지정한다. 

- 제2정규형

  - 데이터가 중복하는 부분을 찾아내어 테이블로 분할해 나간다.

  - 기본키에 의해 특정되는 열과 그렇지 않은 열로 나눈다.

  - 부분 함수종속성을 찾아내서 테이블을 분할한다.

    > 함수종속성 : 키 값을 이용해 데이터를 특정지을 수 있는 것

- 제3정규형

  - 중복하는 부분을 찾아내어 테이블을 분할한다.
  - 기본키 이외에 부분에서 중복이 없는지를 조사한다.

분할할 때에는 서로 결합할 수 있도록 기본키를 추가해 분할한다.

**정규화의 목적** : 하나의 데이터가 한 곳에 저장되도록 하는 것 

정규화되지 않은 경우에는 여기저기 중복해서 저장된 데이터를 검색하고 일일이 변경해야 한다. 인덱스가 지정된 열의 데이터가 변경되는 경우에는 인덱스도 재구축해야 한다.



## 트랜잭션

데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.

몇 단계로 처리를 나누어 SQL 명령을 실행하는 경우에 트랜잭션을 사용한다.

트랜잭션을 사용해서 데이터를 추가할 때는 자동커밋을 꺼야한다. -> 명시적으로 트랜잭션 시작을 선언한다.  - START TRANSACTION (MySQL에서 BEGIN 사용 가능)

- COMMIT : 트랜잭션 내에서 실행한 명령을 적용. 임시 데이터 영역에서 정식 데이터 영역으로 변경이 적용된다.
- ROLLBACK : 트랜잭션 내에서 실행한 명령을 파기. 임시 데이터 영역에서의 처리는 버려진다.

트랜잭션 내에서 실행하는 복수의 SQL 명령은 세트 단위로 유효/무효가 된다.