## 정렬

ORDER BY 구로 정렬하고 싶은 열을 지정한다.

날짜시간형 데이터는 수치형 데이터와 마찬가지로 **숫자 크기**로 판별한다.

문자열형 데이터의 대소관계는 사전식 순서에 의해 결정된다.

- MySQL : NULL 값을 가장 작은 값으로 취급. 오름차순에서는 가장 먼저, 내림차순에서는 가장 나중에 표시

LIMIT 구는 표준 SQL 아니다. (MySQL, PostgreSQL)

오프셋 지정 : 시작 위치 지정. LIMIT 구에 OFFSET으로 지정한다. 배열 인덱스랑 동일



## 수치 연산

나머지 연산 : %, MOD 함수 (MySQL, Oracle 등)

별명을 한글로 지정하는 경우에는 더블쿼트(MySQL에서는 백쿼트)로 둘러싸서 지정한다.

- 더블쿼트 : 데이터베이스 객체명으로 간주 - SQL 표준
- 싱글쿼트 : 문자열 상수

서버 내부의 처리순서 : WHERE 구 -> SELECT 구

=> SELECT 구에서 지정한 별명은 WHERE 구 안에서 사용할 수 없다.

NULL 값 연산 -> 결과는 NULL

ROUND 함수 : 반올림할 때 사용. 기본적으로 소수점 첫째 자리를 기준으로 반올림한 값을 반환한다. 두 번째 인수로 반올림할 자릿수를 지정한다.

- 0 -> 소수점 첫째 자리 / 1 -> 소수점 둘째자리, ...
- -1 -> 1단위 / -2 -> 10단위, ...



## 문자열 연산

문자열 결합

- SQL Server : +
- Oracle, DB2, PostgreSQL : ||
- MySQL : CONCAT 함수

CONCAT 함수 이용해 두 열을 결합. 문자열 결합이지만 수치 데이터도 연산 가능하다. 결과는 문자열형이 된다.

- SUBSTRING 함수 : 문자열 일부 계산해서 반환. SUBSTR(원본문자열, 시작위치, 가져올길이)
- TRIM 함수 : 문자열의 **앞뒤**로 여분의 스페이스가 있을 경우 이를 제거해주는 함수. 문자열 도중에 존재하는 스페이스는 제거되지 않는다.
- CHARACTER_LENGTH 함수 : 문자열의 길이를 계산. CHAR_LENGTH()
- OCTET_LENGTH 함수 : 문자열의 길이를 바이트 단위로 계산

! 문자열 데이터의 길이는 문자세트에 따라 다르다.

- EUC-KR에서 ASCII 문자 1바이트, 한글 2바이트
- UTF-8에서 ASCII 문자 1바이트, 한글 3바이트



## 날짜 연산

표준 SQL - CURRENT_TIMESTAMP 기준

- CURRENT_TIMESTAMP : NOW()와 동일. 년월일 시간
- CURRENT_DATE() : 년월일까지만 나옴

+ 추가
  + SYSDATE() : 쿼리가 끝난 후 현재 시각
  + NOW() : 쿼리를 시작한 순간의 시각
  + 1개의 트랜잭션 내에 다수의 쿼리가 포함되어 있고 중간중간 시간을 조회하거나 조회된 값으로 데이터 입력 또는 변경 시 처음시작과 끝이 동일해야 한다면 NOW() 사용
  + 의도하여 중간중간 조회 시 시간 확인이나 조회 시점의 시간이 필요하다면 SYSDATE() 사용
  + SYSDATE() 함수는 트랜잭션이나 쿼리 단위에 전혀 관계 없이, 그 함수가 실행되는 시점의 시각을 리턴해주지만, NOW()는 하나의 쿼리 단위로 동일한 값을 리턴하게 된다.

날짜형 -> 문자열 : DATE_FORMAT(date, format)

문자열 -> 날짜형 : STR_TO_DATE(str, format)

날짜 차이 : DATEDIFF(기준날짜, 비교날짜) / 기준날짜-비교날짜



## CASE 문

검색 CASE / 단순 CASE

```sql
-- 검색 CASE
CASE
	WHEN 조건식1 THEN 식1
	WHEN 조건식2 THEN 식2 ...
	ELSE 식3
END

-- 단순 CASE
CASE 식1
	WHEN 식2 THEN 식3
	WHEN 식4 THEN 식5 ...
	ELSE 식6
END
```

!ELSE를 생략하면 ELSE NULL 이 되는 것에 주의! -> ELSE를 생략하지 않고 지정하는 편이 낫다.

단순 CASE 문으로는 NULL 값을 비교할 수 없다. (단순 CASE 문은 특성상  = 연산자로 비교하기 때문)

COALESCE 함수 : NULL 값을 변환하는 경우 사용. 주어진 인수 가운데 NULL이 아닌 값에 대해서는 가장 먼저 지정된 인수의 값을 반환한다. 모두 NULL만 들었다면 NULL이 나온다.



## 데이터 추가, 삭제 갱신

### INSERT

- NOT NULL 제약
- Default

### DELETE

WHERE 구를 생략할 경우 모든 행을 대상으로 동작 -> 테이블의 모든 데이터가 삭제된다.

MySQL에서는 DELETE 명령에서 ORDER BY 구와 LIMIT 구를 사용해 삭제할 행을 지정할 수 있다.

### UPDATE

셀 단위로 데이터를 갱신할 수 있다.

WHERE 구가 지정되어 있지 않으면 테이블의 모든 행이 갱신 대상이 된다.

SET 구의 실행 순서

- MySQL은 SET 구에 기술된 순서로 갱신 처리
- Oracle은 SET 구에 기술한 식의 순서가 처리에 영향을 주지 않음



## 물리삭제와 논리삭제

### 물리삭제

SQL의 DELETE 명령을 사용해 직접 데이터를 삭제

### 논리삭제 

테이블에 '삭제플래그'와 같은 열을 미리 준비 -> 테이블에서 실제로 행을 삭제하는 대신, UPDATE 명령을 이용해 '삭제플래그'의 값을 유효하게 갱신장

- 장점 : 데이터를 삭제하지 않기 때문에 삭제되기 전의 상태로 간단히 되돌릴 수 있다.
- 단점 : 삭제해도 데이터베이스의 저장공간이 늘어나지 않는다. 데이터베이스의 크기가 증가함에 따라 검색속도가 떨어진다.

=> 용도에 맞게 선택!

